<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Warehouse Tracker v5</title>
<style>
:root{
  --bg:#0b0d10;--card:#141821;--ink:#e8eef7;--muted:#9fb3c8;--accent:#2f6bff;
  --line:#243244;--red:#b43c3c;--amber:#c28b2b;--green:#2fa34a;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif}
.container{max-width:900px;margin:auto;padding:16px}
h1{font-size:20px;margin:0 0 8px}
h2{font-size:16px;color:var(--muted);margin:14px 0 8px}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px;margin-bottom:12px}
.row{display:flex;gap:8px;flex-wrap:wrap}
input,button{width:100%;padding:10px;border-radius:8px;border:1px solid var(--line);background:#0e1423;color:var(--ink);font-size:15px}
button{cursor:pointer;background:#1b2540}
button.primary{background:var(--accent);color:white}
button.small{padding:6px 8px;font-size:13px}
.toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.kpis{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
.kpi{flex:1 1 150px;background:#101728;border:1px solid var(--line);border-radius:10px;padding:10px}
.kpi .label{font-size:12px;color:var(--muted)}
.kpi .value{font-size:18px;margin-top:2px}
.sub{font-size:12px;color:var(--muted)}
.hidden{display:none!important}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border-bottom:1px solid var(--line);padding:6px;text-align:left}
th{color:#cfe0ff}
.rate.red{color:var(--red)}
.rate.amber{color:var(--amber)}
.rate.green{color:var(--green)}
#admin{margin-top:10px}
</style>
</head>
<body>
<div class="container">
  <h1>Warehouse Tracker v5</h1>
  <div class="kpis">
    <div class="kpi"><div class="label">Units</div><div id="kpiUnits" class="value">0</div></div>
    <div class="kpi"><div class="label">Live Rate (u/h)</div><div id="kpiRate" class="value rate amber">0</div></div>
    <div class="kpi"><div class="label">Gap vs 300</div><div id="kpiGap" class="value">0</div></div>
  </div>

  <div class="card">
    <h2>Shift Setup</h2>
    <div class="row">
      <input id="date" type="text" placeholder="Date (e.g. Tue 25 Oct 2025)">
      <input id="start" type="time">
    </div>
    <div class="toolbar">
      <button class="primary" id="btnStart">Start Shift</button>
      <button id="btnReset">Restart</button>
    </div>
  </div>

  <div class="card">
    <h2>Active Order</h2>
    <div class="row">
      <input id="cust" type="text" placeholder="Customer / Route">
      <input id="qty" type="number" placeholder="Units this order">
    </div>
    <div class="toolbar">
      <button class="small" id="btnWrap">Wrap</button>
      <button class="small" id="btnComplete">Complete</button>
    </div>
  </div>

  <div class="card">
    <h2>Completed Orders</h2>
    <table id="tbl">
      <thead><tr><th>Time</th><th>Customer</th><th>Units</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="card" id="qc">
    <h2>QuickCalc / New Users</h2>
    <div class="row">
      <input id="override" type="number" placeholder="Override Active Rate">
      <input id="target" type="number" placeholder="Target (usually 300)" value="300">
    </div>
    <div class="toolbar">
      <button class="small" id="btnOverride">Apply</button>
      <button class="small" id="btnCalc">Compute u/h</button>
    </div>
    <div class="sub">Type <code>0000</code> in Override Active Rate to unlock Admin Controls.</div>
    <div id="admin" class="hidden">
      <h2>⚙ Admin Controls</h2>
      <div class="toolbar">
        <button id="btnExport">Export</button>
        <button id="btnImport">Import</button>
        <button id="btnClear">Full Reset</button>
      </div>
      <input type="file" id="file" class="hidden" accept="application/json">
    </div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
let state={started:false,startTime:null,orders:[],target:300};

function save(){localStorage.setItem('wh_v5',JSON.stringify(state));}
function load(){const r=localStorage.getItem('wh_v5');if(r){try{state=JSON.parse(r);}catch{}}}

function fmtTime(d){return new Date(d).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}
function hoursSinceStart(){if(!state.startTime)return 0;return (Date.now()-new Date(state.startTime))/3600000;}
function totalUnits(){return state.orders.reduce((a,b)=>a+b.qty,0);}
function rate(){const h=hoursSinceStart();return h>0?totalUnits()/h:0;}
function colorFor(r){if(r<249)return'red';if(r<300)return'amber';return'green';}

function render(){
 const u=totalUnits(),r=rate(),gap=Math.round(r-300);
 $('#kpiUnits').textContent=u;
 const rateEl=$('#kpiRate');
 rateEl.textContent=Math.round(r);
 rateEl.className='value rate '+colorFor(r);
 const gapEl=$('#kpiGap');
 gapEl.textContent=(gap>0?'+':'')+gap;
 gapEl.style.color=gap>0?'var(--green)':gap<0?'var(--red)':'var(--amber)';
 const tb=$('#tbl tbody');tb.innerHTML='';
 state.orders.forEach(o=>{
   const tr=document.createElement('tr');
   tr.innerHTML=`<td>${fmtTime(o.time)}</td><td>${o.cust}</td><td>${o.qty}</td>`;
   tb.append(tr);
 });
 save();
}

$('#btnStart').onclick=()=>{
 if(!$('#start').value){alert('Enter start time');return;}
 state.started=true;state.startTime=new Date($('#date').value+' '+$('#start').value).toISOString();state.orders=[];
 save();render();
};
$('#btnReset').onclick=()=>{if(confirm('Restart shift?')){state.started=false;state.orders=[];save();render();}};
$('#btnWrap').onclick=()=>{if(!state.started)return alert('Start shift first');
 const c=$('#cust').value||'—',q=Number($('#qty').value)||0;
 if(q<=0)return alert('Enter units');
 state.orders.push({time:new Date().toISOString(),cust:c,qty:q});
 $('#cust').value='';$('#qty').value='';render();
};
$('#btnComplete').onclick=$('#btnWrap').onclick;

$('#btnOverride').onclick=()=>{
 const val=$('#override').value.trim();
 if(val==='0000'){document.getElementById('admin').classList.remove('hidden');return;}
 const n=Number(val);if(!isNaN(n)&&n>0){alert('Rate override set to '+n);}
};
$('#btnCalc').onclick=()=>render();
$('#btnClear').onclick=()=>{if(confirm('Clear all data?')){localStorage.removeItem('wh_v5');location.reload();}};
$('#btnExport').onclick=()=>{
 const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
 const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='warehouse-tracker-v5.json';a.click();
};
$('#btnImport').onclick=()=>$('#file').click();
$('#file').addEventListener('change',e=>{
 const f=e.target.files[0];if(!f)return;const r=new FileReader();
 r.onload=()=>{try{state=JSON.parse(r.result);render();}catch{alert('Invalid file');}};r.readAsText(f);
});

load();render();
setInterval(render,15000);
</script>
</body>
</html>
